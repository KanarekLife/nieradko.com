---
title: "Build Docker images quicker with BuildKit"
created: "2024-11-15"
cover: "./cover.png"
---

The reason for writing this blog post was, as it usually is, a very simple and uncomplicated requirement which spiralled into a full day of reading [Docker and Desktop for Desktop documentation](https://docs.docker.com/), 2 coffees and a lot of learning :laughing:.

## The premise

As you may recall from [the previous blog post](/articles/welcome-to-my-new-blog/), this blog is currently hosted on [Cloudflare Pages](https://pages.cloudflare.com/). It's a great service for your hosting needs as it includes: automatic deployments (with build steps) straight from your GitHub / GitLab repository, possiblity of adding [Serverless Functions](https://developers.cloudflare.com/pages/functions/), [Redirects](https://developers.cloudflare.com/pages/configuration/redirects/), [DDoS protection](https://www.cloudflare.com/ddos/) and [generous free tier](https://developers.cloudflare.com/pages/platform/limits/). Moreover as the current user of Cloudflare (I use them as my Domain and DNS hosting), all of this is sugarcoated with nice UX/UI and deep integration of services (f.i. connecting my personal domain to Cloudflare Pages was just one mouse click :sunglasses:).

However, despite how great their free service is, I would like to practice my DevOps skills and as such the end goal was always to host this website on my personal kubernetes cluster. For that, it is obvious that having a well-written and small Docker image would always be a huge benefit and a time-saver. Since most of the time, when I write Dockerfiles for various services, I don't have time to waste I decided to research the topic a bit deeper than usual in hope that maybe there are some solutions to the usual problems I encountered. And well, the documentation did not disappoint!

{/* 

    TODO:
        - Better cache system (which allows rerunning the image build)
        - LLB which allow to skip already cached and unused steps
        - Multiplatform builds
 */}

## Past problems

Docker is one of these technologies which seem hard at the beggining but with time you learn to _tame the beast_. Most of the time you can get by using online references like [Stack Overflow](https://stackoverflow.com/) or [ChatGPT](https://chatgpt.com), but unless you dig deeper you might not realize that there are better ways to do some things. For me, one of the most frustrating part of writing good Dockerfiles were **Docker images buildtime**

![](./cache-stack-invalidated.png)

Docker, by default, caches every layer so that when you re-run `docker build` command it can reuse as much from the previous builds as it is possible. In  Furthermore Docker would execute the layers which were unused in final image and would be difficult to setup for multiplatform builds. All of that changes with [BuildKit](https://docs.docker.com/build/buildkit/)